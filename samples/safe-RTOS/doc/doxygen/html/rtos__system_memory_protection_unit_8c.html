<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>safe-RTOS: rtos_systemMemoryProtectionUnit.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">safe-RTOS<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">safe-RTOS - A simple RTOS with safety support for MPC5748G</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('rtos__system_memory_protection_unit_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">rtos_systemMemoryProtectionUnit.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;assert.h&gt;</code><br />
<code>#include &quot;MPC5748G.h&quot;</code><br />
<code>#include &quot;<a class="el" href="typ__types_8h_source.html">typ_types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rtos_8h_source.html">rtos.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rtos__kernel_instance_data_8h_source.html">rtos_kernelInstanceData.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="rtos__system_memory_protection_unit_8h_source.html">rtos_systemMemoryProtectionUnit.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab14ed9a2a11721c1eb41ca41d205ed9c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtos__system_memory_protection_unit_8c.html#ab14ed9a2a11721c1eb41ca41d205ed9c">RTOS_DISARM_RAM_MPU</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ab14ed9a2a11721c1eb41ca41d205ed9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92fe363d847a1cd39a4a512557814235"><td class="memItemLeft" align="right" valign="top"><a id="a92fe363d847a1cd39a4a512557814235" name="a92fe363d847a1cd39a4a512557814235"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD3_ACCESS_SET_RAM</b>&#160;&#160;&#160;RGD_WRD3(074u, 077u, 076u, /* CI */ 0u)</td></tr>
<tr class="separator:a92fe363d847a1cd39a4a512557814235"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabb5738928483f101fd213a726ec58a4"><td class="memItemLeft" align="right" valign="top"><a id="aabb5738928483f101fd213a726ec58a4" name="aabb5738928483f101fd213a726ec58a4"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD3_ACCESS_SET_RAM_CI</b>&#160;&#160;&#160;RGD_WRD3(074u, 077u, 076u, /* CI */ 1u)</td></tr>
<tr class="separator:aabb5738928483f101fd213a726ec58a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab1eb5684ba453389021795fda5a9feb0"><td class="memItemLeft" align="right" valign="top"><a id="ab1eb5684ba453389021795fda5a9feb0" name="ab1eb5684ba453389021795fda5a9feb0"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD2_ALL_RAM</b>&#160;&#160;&#160;RGD_WRD2(/* idxPattern */ 1u)</td></tr>
<tr class="separator:ab1eb5684ba453389021795fda5a9feb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7283b1f802469e9e5c5c95cfab9d21dd"><td class="memItemLeft" align="right" valign="top"><a id="a7283b1f802469e9e5c5c95cfab9d21dd" name="a7283b1f802469e9e5c5c95cfab9d21dd"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD2_PROCESS_RAM</b>&#160;&#160;&#160;RGD_WRD2(/* idxPattern */ 2u)</td></tr>
<tr class="separator:a7283b1f802469e9e5c5c95cfab9d21dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65b9398e80ebb29dc941a13e403c8cf1"><td class="memItemLeft" align="right" valign="top"><a id="a65b9398e80ebb29dc941a13e403c8cf1" name="a65b9398e80ebb29dc941a13e403c8cf1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD2_SHARED_RAM</b>&#160;&#160;&#160;RGD_WRD2(/* idxPattern */ 3u)</td></tr>
<tr class="separator:a65b9398e80ebb29dc941a13e403c8cf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad698b8265548e164d3935ea9b2690202"><td class="memItemLeft" align="right" valign="top"><a id="ad698b8265548e164d3935ea9b2690202" name="ad698b8265548e164d3935ea9b2690202"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD3_ACCESS_SET_ROM_PERIPHERALS</b>&#160;&#160;&#160;RGD_WRD3(055u, 060u, 050u, /* CI */ 0u)</td></tr>
<tr class="separator:ad698b8265548e164d3935ea9b2690202"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bd7599fec2cce6482f4ed5627d2e50d"><td class="memItemLeft" align="right" valign="top"><a id="a5bd7599fec2cce6482f4ed5627d2e50d" name="a5bd7599fec2cce6482f4ed5627d2e50d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD2_ALL_ROM</b>&#160;&#160;&#160;RGD_WRD2(/* idxPattern */ 1u)</td></tr>
<tr class="separator:a5bd7599fec2cce6482f4ed5627d2e50d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a593e6cb7f0abd7c588ad2a15b4fa6f9d"><td class="memItemLeft" align="right" valign="top"><a id="a593e6cb7f0abd7c588ad2a15b4fa6f9d" name="a593e6cb7f0abd7c588ad2a15b4fa6f9d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD2_PERIPHERALS</b>&#160;&#160;&#160;RGD_WRD2(/* idxPattern */ 2u)</td></tr>
<tr class="separator:a593e6cb7f0abd7c588ad2a15b4fa6f9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2cefe315e9770d6a1d68e4ba15dc070"><td class="memItemLeft" align="right" valign="top"><a id="ac2cefe315e9770d6a1d68e4ba15dc070" name="ac2cefe315e9770d6a1d68e4ba15dc070"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD2_RESERVED_BLOCK</b>&#160;&#160;&#160;RGD_WRD2(/* idxPattern */ 3u) /* See below */</td></tr>
<tr class="separator:ac2cefe315e9770d6a1d68e4ba15dc070"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ec6e2e8a4466f1607e96d997f360200"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtos__system_memory_protection_unit_8c.html#a2ec6e2e8a4466f1607e96d997f360200">RGD_WRD2</a>(idxPattern)</td></tr>
<tr class="separator:a2ec6e2e8a4466f1607e96d997f360200"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35c5ce45170b09355a1d7e988a43a60b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtos__system_memory_protection_unit_8c.html#a35c5ce45170b09355a1d7e988a43a60b">RGD_WRD3</a>(accset1,  accset2,  accset3,  cacheInhibit)</td></tr>
<tr class="separator:a35c5ce45170b09355a1d7e988a43a60b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af66ab9bcc6fda95661cdc82113194ded"><td class="memItemLeft" align="right" valign="top"><a id="af66ab9bcc6fda95661cdc82113194ded" name="af66ab9bcc6fda95661cdc82113194ded"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD4_PIT_AWARE</b>(pid)&#160;&#160;&#160;(((pid)&lt;&lt;24) | ((pid)&gt;0? 1u: 0u))</td></tr>
<tr class="separator:af66ab9bcc6fda95661cdc82113194ded"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3330522e342654622808f51ae37d420a"><td class="memItemLeft" align="right" valign="top"><a id="a3330522e342654622808f51ae37d420a" name="a3330522e342654622808f51ae37d420a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD4_NO_PID_COMPARISON</b>&#160;&#160;&#160;(0u)</td></tr>
<tr class="separator:a3330522e342654622808f51ae37d420a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1b8c92d1da134eaee6b90bd3a6d12c79"><td class="memItemLeft" align="right" valign="top"><a id="a1b8c92d1da134eaee6b90bd3a6d12c79" name="a1b8c92d1da134eaee6b90bd3a6d12c79"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>WORD5_LOCK_AND_ENABLE</b>&#160;&#160;&#160;(SMPU_WORD5_LCK(3) | SMPU_WORD5_VLD(1))</td></tr>
<tr class="separator:a1b8c92d1da134eaee6b90bd3a6d12c79"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48449e3c7f5a302914fa2359b0f1d499"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtos__system_memory_protection_unit_8c.html#a48449e3c7f5a302914fa2359b0f1d499">CONFIG_REGIONS_PROC_RAM</a>(pid)</td></tr>
<tr class="separator:a48449e3c7f5a302914fa2359b0f1d499"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a22f18df80ca97d1ee72313364f55ffa0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtos__system_memory_protection_unit_8c.html#a22f18df80ca97d1ee72313364f55ffa0">CONFIG_REGION_DESC_PROC_RAM</a>(pid,  section,  CI)</td></tr>
<tr class="separator:a22f18df80ca97d1ee72313364f55ffa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ea2cafb6afb46293c8aecba2e261973"><td class="memItemLeft" align="right" valign="top"><a id="a4ea2cafb6afb46293c8aecba2e261973" name="a4ea2cafb6afb46293c8aecba2e261973"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>from</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a4ea2cafb6afb46293c8aecba2e261973"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6c611b6312d83f13b18d70d156aab8f"><td class="memItemLeft" align="right" valign="top"><a id="af6c611b6312d83f13b18d70d156aab8f" name="af6c611b6312d83f13b18d70d156aab8f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>to</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:af6c611b6312d83f13b18d70d156aab8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6890442e1cc24a0d61597a13576b8727"><td class="memItemLeft" align="right" valign="top"><a id="a6890442e1cc24a0d61597a13576b8727" name="a6890442e1cc24a0d61597a13576b8727"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SDA</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:a6890442e1cc24a0d61597a13576b8727"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c7209e41a40542f1caff8b7284dbda"><td class="memItemLeft" align="right" valign="top"><a id="a02c7209e41a40542f1caff8b7284dbda" name="a02c7209e41a40542f1caff8b7284dbda"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SDA2</b>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a02c7209e41a40542f1caff8b7284dbda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad9ae913bdfab20dd94ad04ee2d5b045"><td class="memItemLeft" align="right" valign="top"><a id="aad9ae913bdfab20dd94ad04ee2d5b045" name="aad9ae913bdfab20dd94ad04ee2d5b045"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DATA</b>&#160;&#160;&#160;2</td></tr>
<tr class="separator:aad9ae913bdfab20dd94ad04ee2d5b045"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2361ca51795854813d69ee274b326e8"><td class="memItemLeft" align="right" valign="top"><a id="aa2361ca51795854813d69ee274b326e8" name="aa2361ca51795854813d69ee274b326e8"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>addrPrcAryAry</b>(prc)&#160;&#160;&#160;{[from] = addrAry(prc, Start), [to] = addrAry(prc, End)}</td></tr>
<tr class="separator:aa2361ca51795854813d69ee274b326e8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a237ec8ef4e592440f07488b7a97f27a1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtos__system_memory_protection_unit_8c.html#a237ec8ef4e592440f07488b7a97f27a1">rtos_osInitMPU</a> (void)</td></tr>
<tr class="separator:a237ec8ef4e592440f07488b7a97f27a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f1f4dbf31cbe5dd7c48a1f4ea2d594f"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rtos__system_memory_protection_unit_8c.html#a4f1f4dbf31cbe5dd7c48a1f4ea2d594f">rtos_checkUserCodeWritePtr</a> (unsigned int PID, const void *address, size_t noBytes)</td></tr>
<tr class="separator:a4f1f4dbf31cbe5dd7c48a1f4ea2d594f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Configuration and initialization of the Memory Protection Unit (MPU). The configuration is chosen static in this sample. The initially chosen configuration is never changed during run-time.<br  />
 The configuration uses a descriptor for all ROM, which is occupied by the compiled code: All processes have read and execution access. Write access, although it can't do any harm is forbidden: According run-time failure reporting will point to definite implementation errors.<br  />
 The configuration has one descriptor for all RAM, which is occupied by the compiled code. All processes have read access and only the OS process has write and execute access, too.<br  />
 The configuration has one descriptor for the entire peripheral address space. The OS process has read and write access.<br  />
 Each of the four user processes has three descriptors, all of them for RAM write and execute access. There's a descriptor for the initialized data and bss, one for the small data and bss and one for the small data 2 and bss 2.<br  />
 The configuration has one descriptor for a chunk of memory, which all user processes have read and write access to. This memory is meant for inter-process communication and must evidently never be used to hold data, which is essential for the health of a process and in particular for the process, that implements supervisory safety tasks.<br  />
 The static configuration of the MPU is the explanation for the fixed number of four supported processes (<a class="el" href="rtos_8h.html#a18500a557ecd5ebbcefbacba22b58d7e">RTOS_NO_PROCESSES</a>). For the partitioning of the RAM space, we need three descriptors per user process and one for the OS and we have 16 descriptors available. From the remaining three, we have spend one for shared data. Two descriptors are still available.<br  />
 CAUTION: The mentioned memory chunks or areas are created by the linker. The MPU configuration makes no hard coded assumptions about memory arrangement and distribution or addresses and sizes of the chunks. It reads address and length of the memory chunks from linker provided symbols. Insofar do we have a very tight relationship between the implementation of this module and the linker script, which must be obeyed when doing maintenance work at either side.</p>
<p >Alternative configurations, which may find their use case and do not break the safety concept:</p><ul>
<li>The OS process doesn't necessarily need execution access for RAM. There are typical driver implementation patterns, which require RAM execution rights, but it is mostly about initialization and could be done prior to calling the MPU configuration.<br  />
</li>
<li>The user processes won't normally need execution rights for their RAM<br  />
</li>
<li>It is possible to let a process with higher privileges have access to the memories of all processes with lower privileges. Below, it is explained how to do this<br  />
</li>
<li>If the number of processes is reduced (a safety concept requires two processes at minimum) then each process could have up to six descriptors. This would enable a configuration with disjunct small data and bss chunks so that the waste of data image ROM disappears, which the current configuration has (see linker script for details)<br  />
</li>
<li>The shared memory section can be disabled if not required for the inter-process communication<br  />
</li>
<li>A fifth process could be defined using the unused descriptors. Most code barely makes use of SDA2 and since we mostly use explicit data object placing it's definitely not essential. This way it would even be possible to define up to seven processes, each using two descriptors.<br  />
</li>
<li>A difficult topic is the placing of the small data 2 and bss 2 sections. It is possible to locate them into the ROM. This is likely not fully compliant with the EABI but for all normal embedded applications alright. In which case we had four free descriptors and could implement two more processes. A similar concept for increasing the number of processes would be entirely switching off the short addressing modes. This is a matter of the compiler command line</li>
</ul>
<p >Copyright (C) 2018-2024 Peter Vranken (<a href="#" onclick="location.href='mai'+'lto:'+'Pet'+'er'+'_Vr'+'an'+'ken'+'@Y'+'aho'+'o.'+'de'; return false;">Peter<span class="obfuscator">.nosp@m.</span>_Vra<span class="obfuscator">.nosp@m.</span>nken@<span class="obfuscator">.nosp@m.</span>Yaho<span class="obfuscator">.nosp@m.</span>o.de</a>)</p>
<p >This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.</p>
<p >This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.</p>
<p >You should have received a copy of the GNU General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ab14ed9a2a11721c1eb41ca41d205ed9c" name="ab14ed9a2a11721c1eb41ca41d205ed9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab14ed9a2a11721c1eb41ca41d205ed9c">&#9670;&nbsp;</a></span>RTOS_DISARM_RAM_MPU</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RTOS_DISARM_RAM_MPU&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Development support: If this define is set to one than the entire RAM is writable for all processes. </p>

</div>
</div>
<a id="a2ec6e2e8a4466f1607e96d997f360200" name="a2ec6e2e8a4466f1607e96d997f360200"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ec6e2e8a4466f1607e96d997f360200">&#9670;&nbsp;</a></span>RGD_WRD2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RGD_WRD2</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">idxPattern</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">                                  ((((idxPattern)&amp;0x3u)&lt;&lt;(15*2))   <span class="comment">/* M0 */</span>  \</div>
<div class="line">                                  | (((idxPattern)&amp;0x3u)&lt;&lt;(14*2)) <span class="comment">/* M1 */</span>  \</div>
<div class="line">                                  | (((idxPattern)&amp;0x3u)&lt;&lt;(13*2)) <span class="comment">/* M2 */</span>  \</div>
<div class="line">                                  | (((idxPattern)&amp;0x3u)&lt;&lt;(11*2)) <span class="comment">/* M4 */</span>  \</div>
<div class="line">                                  | (((    3u    )&amp;0x3u)&lt;&lt;(10*2)) <span class="comment">/* M5 */</span>  \</div>
<div class="line">                                  | (((idxPattern)&amp;0x3u)&lt;&lt;(7*2))  <span class="comment">/* M8 */</span>  \</div>
<div class="line">                                  | (((idxPattern)&amp;0x3u)&lt;&lt;(6*2))  <span class="comment">/* M9 */</span>  \</div>
<div class="line">                                  | (((idxPattern)&amp;0x3u)&lt;&lt;(5*2))  <span class="comment">/* M10 */</span> \</div>
<div class="line">                                 )</div>
</div><!-- fragment -->
</div>
</div>
<a id="a35c5ce45170b09355a1d7e988a43a60b" name="a35c5ce45170b09355a1d7e988a43a60b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35c5ce45170b09355a1d7e988a43a60b">&#9670;&nbsp;</a></span>RGD_WRD3</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define RGD_WRD3</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">accset1, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">accset2, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">accset3, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">cacheInhibit&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">                ((((accset1)&amp;0x3fu)&lt;&lt;26) | (((accset2)&amp;0x3fu)&lt;&lt;20) | (((accset3)&amp;0x3fu)&lt;&lt;14)\</div>
<div class="line">                 | ((<span class="comment">/*FMT*/</span> 1u)&lt;&lt;4) | (((cacheInhibit)&amp;1u)&lt;&lt;1)                             \</div>
<div class="line">                )</div>
</div><!-- fragment -->
</div>
</div>
<a id="a48449e3c7f5a302914fa2359b0f1d499" name="a48449e3c7f5a302914fa2359b0f1d499"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48449e3c7f5a302914fa2359b0f1d499">&#9670;&nbsp;</a></span>CONFIG_REGIONS_PROC_RAM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONFIG_REGIONS_PROC_RAM</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">pid</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">        {                                                                           \</div>
<div class="line">            CONFIG_REGION_DESC_PROC_RAM(pid, <span class="comment">/* section */</span> data, <span class="comment">/* CI? (no) */</span>)    \</div>
<div class="line">            CONFIG_REGION_DESC_PROC_RAM(pid, <span class="comment">/* section */</span> sda , <span class="comment">/* CI? (no) */</span>)    \</div>
<div class="line">            CONFIG_REGION_DESC_PROC_RAM(pid, <span class="comment">/* section */</span> sda2, <span class="comment">/* CI? */</span> _CI)     \</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a22f18df80ca97d1ee72313364f55ffa0" name="a22f18df80ca97d1ee72313364f55ffa0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a22f18df80ca97d1ee72313364f55ffa0">&#9670;&nbsp;</a></span>CONFIG_REGION_DESC_PROC_RAM</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CONFIG_REGION_DESC_PROC_RAM</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">pid, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">section, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">CI&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">        {                                                                                   \</div>
<div class="line">            extern uint8_t ld_##section##P##pid##Start[0], ld_##section##P##pid##End[0];    \</div>
<div class="line">            assert(((uintptr_t)ld_##section##P##pid##Start &amp; 0xf) == 0                      \</div>
<div class="line">                   &amp;&amp;  ((uintptr_t)ld_##section##P##pid##End &amp; 0xf) == 0                    \</div>
<div class="line">                  );                                                                        \</div>
<div class="line">            SMPU_1-&gt;RGD[r].WORD0    = (uintptr_t)ld_##section##P##pid##Start;<span class="comment">/* from */</span>     \</div>
<div class="line">            SMPU_1-&gt;RGD[r].WORD1    = (uintptr_t)ld_##section##P##pid##End-1;<span class="comment">/* to, incl. */</span>\</div>
<div class="line">            SMPU_1-&gt;RGD[r].WORD2.F1 = WORD2_PROCESS_RAM;                                    \</div>
<div class="line">            SMPU_1-&gt;RGD[r].WORD3    = WORD3_ACCESS_SET_RAM##CI;                             \</div>
<div class="line">            SMPU_1-&gt;RGD[r].WORD4    = WORD4_PIT_AWARE(pid);                                 \</div>
<div class="line">            SMPU_1-&gt;RGD[r].WORD5    = WORD5_LOCK_AND_ENABLE;<span class="comment">/* Enable region descriptor. */</span> \</div>
<div class="line">            ++ r;                                                                           \</div>
<div class="line">        }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a237ec8ef4e592440f07488b7a97f27a1" name="a237ec8ef4e592440f07488b7a97f27a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a237ec8ef4e592440f07488b7a97f27a1">&#9670;&nbsp;</a></span>rtos_osInitMPU()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rtos_osInitMPU </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Configure and initialize the memory protection units SMPU_0 and SMPU_1. The configuration is static; a set of regions suitable for the RTOS (and its project dependent configuration) is defined and then the unit is enabled.<br  />
 See module description for more details. </p><dl class="section remark"><dt>Remarks</dt><dd>The processes are shared between the cores and, as a consequence, one static MPU configuration is used to control the behavior of all three cores. Regardless, how many cores are run, this function must be called only once and it must be called when the first of the three cores starts up. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000015">Todo:</a></b></dt><dd>TBC: Does DMA use SV rights? Otherwise don't handle all masters same </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000016">Todo:</a></b></dt><dd>Many (sda) regions are empty. Use an if to avoid spending a descriptor: This makes it particularly easy to have more than 4 processes by intentionally not using sda2 </dd></dl>

</div>
</div>
<a id="a4f1f4dbf31cbe5dd7c48a1f4ea2d594f" name="a4f1f4dbf31cbe5dd7c48a1f4ea2d594f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4f1f4dbf31cbe5dd7c48a1f4ea2d594f">&#9670;&nbsp;</a></span>rtos_checkUserCodeWritePtr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool rtos_checkUserCodeWritePtr </td>
          <td>(</td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>PID</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>noBytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Helper function, mainly intended to support safe system call handler implementation: Check if a pointer value is valid for writing in the context of a given process.<br  />
 A system call handler must never trust a user code provided pointer; evidently not for write access but not even for read operation (a read into the address space of peripherals can have a side effect). The user code could make the system call handler overwrite some non-process owned data objects, cause an access violation in the supervisor code or manipulate some peripherals.<br  />
 Normally, it's strongly disencouraged having pointers as arguments of system calls at all. If not avoidable, one can use this helper function to check that a pointer points into permitted address space and that all bytes of a data object pointed at are still in that address space. Here for write access.<br  />
 Permitted address space is anywhere, where the process may write without causing an exception or any kind of side effect. In particular, this means the process' own RAM and the shared RAM. </p><dl class="section return"><dt>Returns</dt><dd>Get <em>true</em> if the pointer may be used for write access and <em>false</em> otherwise. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">PID</td><td>The ID of the process the query relates to. Range is 1..4. </td></tr>
    <tr><td class="paramname">address</td><td>The pointer value, or the beginning of the chunk of memory, which needs to be entirely located in writable memory. </td></tr>
    <tr><td class="paramname">noBytes</td><td>The size of the chunk of memory to be checked. Must not be less than one. (Checked by assertion). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section remark"><dt>Remarks</dt><dd>The counterpart function <a class="el" href="rtos_8h.html#aac7a5ed04ef56818262cd5288d327648">rtos_checkUserCodeReadPtr()</a> is implemented as inline function in the RTOS API header file, <a class="el" href="rtos_8h.html">rtos.h</a>. </dd>
<dd>
Although this function is intended for use inside a system call handler it can be safely used from user code, too. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_050edd66366d13764f98250ef6db77f6.html">code</a></li><li class="navelem"><a class="el" href="dir_9cd24f4fec2e6f6bedbcc5407321d78a.html">system</a></li><li class="navelem"><a class="el" href="dir_34effe5aae1be93d744f092611be46f1.html">RTOS</a></li><li class="navelem"><a class="el" href="rtos__system_memory_protection_unit_8c.html">rtos_systemMemoryProtectionUnit.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
