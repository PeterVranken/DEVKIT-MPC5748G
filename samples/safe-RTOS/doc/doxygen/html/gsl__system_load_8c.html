<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>safe-RTOS: gsl_systemLoad.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">safe-RTOS<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">safe-RTOS - A simple RTOS with safety support for MPC5748G</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('gsl__system_load_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">gsl_systemLoad.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;assert.h&gt;</code><br />
<code>#include &quot;<a class="el" href="typ__types_8h_source.html">typ_types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="del__delay_8h_source.html">del_delay.h</a>&quot;</code><br />
<code>#include &quot;ccl_configureClocks.h&quot;</code><br />
<code>#include &quot;stm_systemTimer.h&quot;</code><br />
<code>#include &quot;<a class="el" href="gsl__system_load_8h_source.html">gsl_systemLoad.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a1a0ebbe40291f935fed867fb36bde4c9"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gsl__system_load_8c.html#a1a0ebbe40291f935fed867fb36bde4c9">TI_WINDOW_LEN_MS</a>&#160;&#160;&#160;1493u</td></tr>
<tr class="separator:a1a0ebbe40291f935fed867fb36bde4c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa7c5ae83ab54b685d183512e5c2ac41"><td class="memItemLeft" align="right" valign="top"><a id="aaa7c5ae83ab54b685d183512e5c2ac41" name="aaa7c5ae83ab54b685d183512e5c2ac41"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>IDX_STM_TIMER</b>&#160;&#160;&#160;0</td></tr>
<tr class="separator:aaa7c5ae83ab54b685d183512e5c2ac41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36bf779924d84515a506c81b5a4d24d3"><td class="memItemLeft" align="right" valign="top"><a id="a36bf779924d84515a506c81b5a4d24d3" name="a36bf779924d84515a506c81b5a4d24d3"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>STM_TIMER_CLK</b>&#160;&#160;&#160;STM_TIMER_0_CLK</td></tr>
<tr class="separator:a36bf779924d84515a506c81b5a4d24d3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad419cbc7dcaf42970a94d58b8e7fe01d"><td class="memItemLeft" align="right" valign="top"><a id="ad419cbc7dcaf42970a94d58b8e7fe01d" name="ad419cbc7dcaf42970a94d58b8e7fe01d"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>TI_STEP_IN_MS</b>&#160;&#160;&#160;100u</td></tr>
<tr class="separator:ad419cbc7dcaf42970a94d58b8e7fe01d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a7d17a45925383e2a8ac7b4b3853d5ff5"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gsl__system_load_8c.html#a7d17a45925383e2a8ac7b4b3853d5ff5">gsl_osGetSystemLoad</a> (void)</td></tr>
<tr class="separator:a7d17a45925383e2a8ac7b4b3853d5ff5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Measure the current CPU load produced by the application code. A support function for the use with the PowerPC RTOS. </p><dl class="section see"><dt>See also</dt><dd>uint8_t <a class="el" href="gsl__system_load_8c.html#a7d17a45925383e2a8ac7b4b3853d5ff5">gsl_osGetSystemLoad(void)</a></dd></dl>
<p>This file is an adoption from the Arduino RTOS RTuinOS. The original file has been downloaded from <a href="https://svn.code.sf.net/p/rtuinos/code/trunk/code/RTOS/gsl_systemLoad.c">https://svn.code.sf.net/p/rtuinos/code/trunk/code/RTOS/gsl_systemLoad.c</a> on Nov 15, 2017.<br  />
 The major difference of this implementation to the original RTuinOS source is the change to the native 32 Bit data type for the calculations. The Arduino function delayMicroseconds() has been replaced by the PowerPC substitute <a class="el" href="del__delay_8h.html#adde78a9a929e9ab2600534a056680224">del_delayMicroseconds()</a>.</p>
<p >Copyright (C) 2012-2020 Peter Vranken (<a href="#" onclick="location.href='mai'+'lto:'+'Pet'+'er'+'_Vr'+'an'+'ken'+'@Y'+'aho'+'o.'+'de'; return false;">Peter<span class="obfuscator">.nosp@m.</span>_Vra<span class="obfuscator">.nosp@m.</span>nken@<span class="obfuscator">.nosp@m.</span>Yaho<span class="obfuscator">.nosp@m.</span>o.de</a>)</p>
<p >This program is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser General Public License as published by the Free Software Foundation, either version 3 of the License, or any later version.</p>
<p >This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.</p>
<p >You should have received a copy of the GNU Lesser General Public License along with this program. If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a1a0ebbe40291f935fed867fb36bde4c9" name="a1a0ebbe40291f935fed867fb36bde4c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a0ebbe40291f935fed867fb36bde4c9">&#9670;&nbsp;</a></span>TI_WINDOW_LEN_MS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TI_WINDOW_LEN_MS&#160;&#160;&#160;1493u</td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Averaging time window of <a class="el" href="gsl__system_load_8c.html#a7d17a45925383e2a8ac7b4b3853d5ff5">gsl_osGetSystemLoad(void)</a> in ms. The window should contain a full cycle of tasks activations. To avoid integer overflows, the window size must be significantly below 27s. We prefer a prime number to get most likely a sliding window with respect to the typical RTOS configurations with their regular tasks as multiples of a Millisecond (better average). </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a7d17a45925383e2a8ac7b4b3853d5ff5" name="a7d17a45925383e2a8ac7b4b3853d5ff5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d17a45925383e2a8ac7b4b3853d5ff5">&#9670;&nbsp;</a></span>gsl_osGetSystemLoad()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int gsl_osGetSystemLoad </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >A diagnostic function, which can be used to estimate the current system load. The function executes some test code of known CPU execution time and relates this known time to the measured, actually elapsed world time. The function needs to be called from the idle task only. Now the mentioned ratio is a measure for the system load: The lesser the system idles the longer it'll take to execute the test code.<br  />
 On principal, the execution time of the function depends on the system load and can raise to infinite if the load approaches 100%. This effect is lowered by splitting the test code in pieces and ending the measurement if enough pieces have been executed to get the desired resolution. Nonetheless, the effect remains and no upper boundary can be given for the execution time of this function if the system load is close to 100%.<br  />
 Normally, the execution time of this function is about 1 second. This long time is needed to have a sufficient averaging effect; typically the CPU consumption by the tasks is quite irregular due to the complex task activation pattern of the scheduler. The averaging time can be changed at compile time, please see macro <a class="el" href="gsl__system_load_8c.html#a1a0ebbe40291f935fed867fb36bde4c9">TI_WINDOW_LEN_MS</a>. </p><dl class="section return"><dt>Returns</dt><dd>The system load is returned with a resolution 0.1%, i.e. as an integer number in the range 0..1000. </dd></dl>
<dl class="section remark"><dt>Remarks</dt><dd>The function execution takes a long time (above 1s). It must only be called from the idle task and only if there are no other essential jobs for the idle task. </dd>
<dd>
The function will never return if the CPU load is 100% and it might take an arbitrary long time to return if it is close to 100%. The calling code must anticipate this, e.g. by presetting the result variable with 100% prior to calling this function. </dd>
<dd>
If the idle task contains other code besides repeatedly calling this function, then the execution time of that code is not considered by the measurement, it does not contribute to the returned CPU load result. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_050edd66366d13764f98250ef6db77f6.html">code</a></li><li class="navelem"><a class="el" href="dir_9cd24f4fec2e6f6bedbcc5407321d78a.html">system</a></li><li class="navelem"><a class="el" href="dir_34effe5aae1be93d744f092611be46f1.html">RTOS</a></li><li class="navelem"><a class="el" href="gsl__system_load_8c.html">gsl_systemLoad.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
